<div class="books-containers">
  
  <div class="books-con-left">
    <div class="con-left-top">
      <app-categories
        (categorySelected)="handleFilterBooks($event)"
        (librarySelected)="handleFilterLibraries($event)"
      ></app-categories>
    </div>
    <div class="con-left-bottom">
      <div class="books-tp">
        <h2>Books</h2>
      </div>
      <div class="books-list">
        <table>
          <thead>
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Category</th>
              <th>Published Date</th>
              <th>Available Copies</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filterBookList()">
              <td>{{ item.title | titlecase }}</td>
              <td>{{ item.author | titlecase }}</td>
              <td>{{ getCategoryName(item.categoryId)| titlecase }}</td>
              <td>{{ item.publishDate }}</td>
              <td>
                {{ (item.availableCopies === 0)?"Not Available":item.availableCopies }}
              </td>
              <td class="bookListBtn">
                <button
                  (click)="reserveBook(item.id)"
                  [ngClass]="{'out-of-stock': item.availableCopies === 0  }"
                  [disabled]="item.availableCopies === 0"
                >
                  Get
                </button>
                <button (click)="updateBook(item.id)">Edit</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- form  -->
  <app-book-form
    [bookData]="bookData"
    (bookDataChange)="addBook($event)"
    [editBook]="editBook"
    [libraryList]="libraryList()"
    [categoryList]="categoryList()"
  >
  </app-book-form>
</div>

<div *ngIf="reserverPopup" class="popup-overlay">
  <div class="popup-content">
    <h2>Reserve a Book</h2>
    <form (ngSubmit)="handleReserve(reservForm)" #reservForm="ngForm">
      <label for="book">Select Book:</label>
      <select [(ngModel)]="newLoan.bookId" id="book" name="book" required>
        <option *ngFor="let item of availableBookList()" [value]="item.id">
          {{ item.title }}
        </option>
      </select>

      <label for="member">Select Member:</label>
      <select [(ngModel)]="newLoan.memberId" id="member" name="member" required>
        <option value="" disabled selected>Select a member</option>
        <option *ngFor="let item of memberList()" [value]="item.memberId">
          {{ item.fullName }}
        </option>
      </select>

      <label for="due-date">Select Due date:</label>
      <input
        id="due-date"
        type="date"
        [(ngModel)]="newLoan.dueTime"
        name="dueDate"
        required
      />

      <div class="popup-actions">
        <button type="submit" [disabled]="reservForm.invalid ">Reserve</button>
        <button type="button" (click)="reserverPopup = false">Cancel</button>
      </div>
    </form>
  </div>
</div>
